<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solai Demo ‚Äî Chatbot Empire Essence</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --gold: #F5A623;
  --dark: #09090B;
  --dark-card: #111113;
  --dark-border: #1E1E22;
  --gray-300: #D4D4D8;
  --gray-400: #A1A1AA;
  --gray-500: #71717A;
  --gray-600: #52525B;
  --white: #FAFAFA;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter',system-ui,sans-serif; background:var(--dark); color:var(--gray-300); min-height:100vh; display:flex; flex-direction:column; }

/* Header */
.demo-header {
  padding: 16px 24px;
  border-bottom: 1px solid var(--dark-border);
  display: flex; justify-content: space-between; align-items: center;
}
.demo-header h1 { font-size: 1em; font-weight: 700; color: var(--white); }
.demo-header h1 span { color: var(--gold); }
.demo-badge {
  background: rgba(245,166,35,0.1); border: 1px solid rgba(245,166,35,0.2);
  color: var(--gold); font-size: 0.75em; font-weight: 600;
  padding: 4px 12px; border-radius: 100px;
}
.back-link { color: var(--gray-500); text-decoration: none; font-size: 0.85em; }
.back-link:hover { color: var(--white); }

/* Layout */
.demo-layout { display: flex; flex: 1; overflow: hidden; }

/* Sidebar - Phone mockup info */
.demo-sidebar {
  width: 360px; padding: 40px 32px;
  border-right: 1px solid var(--dark-border);
  display: flex; flex-direction: column; gap: 24px;
  overflow-y: auto;
}
.sidebar-section h3 { font-size: 0.8em; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gold); margin-bottom: 12px; }
.sidebar-section p { font-size: 0.9em; color: var(--gray-500); line-height: 1.6; }
.stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.stat-box {
  background: var(--dark-card); border: 1px solid var(--dark-border); border-radius: 10px;
  padding: 16px; text-align: center;
}
.stat-box .val { font-size: 1.5em; font-weight: 800; color: var(--gold); }
.stat-box .lbl { font-size: 0.7em; color: var(--gray-500); margin-top: 2px; }
.feature-list { list-style: none; }
.feature-list li { padding: 8px 0; font-size: 0.85em; color: var(--gray-400); display: flex; gap: 8px; align-items: flex-start; }
.feature-list .icon { color: var(--gold); flex-shrink: 0; }

/* Chat area */
.chat-area { flex: 1; display: flex; flex-direction: column; }
.chat-header {
  padding: 16px 24px; border-bottom: 1px solid var(--dark-border);
  display: flex; align-items: center; gap: 12px;
}
.chat-avatar {
  width: 40px; height: 40px; border-radius: 50%;
  background: linear-gradient(135deg, #c9a94e, #a07c2a);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2em;
}
.chat-name { font-weight: 700; color: var(--white); font-size: 0.95em; }
.chat-status { font-size: 0.75em; color: #4ade80; }

.chat-messages {
  flex: 1; overflow-y: auto; padding: 24px;
  display: flex; flex-direction: column; gap: 12px;
}

.msg {
  max-width: 80%; padding: 12px 16px; border-radius: 16px;
  font-size: 0.92em; line-height: 1.5; animation: fadeIn 0.3s ease;
}
@keyframes fadeIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
.msg-bot {
  background: var(--dark-card); border: 1px solid var(--dark-border);
  color: var(--gray-300); align-self: flex-start;
  border-bottom-left-radius: 4px;
}
.msg-user {
  background: var(--gold); color: var(--dark);
  align-self: flex-end; font-weight: 500;
  border-bottom-right-radius: 4px;
}
.msg-bot .product-card {
  background: rgba(245,166,35,0.05); border: 1px solid rgba(245,166,35,0.15);
  border-radius: 10px; padding: 12px; margin-top: 8px;
}
.product-card h4 { color: var(--gold); font-size: 0.95em; margin-bottom: 4px; }
.product-card .notes { font-size: 0.8em; color: var(--gray-500); }
.product-card .inspired { font-size: 0.75em; color: var(--gray-600); margin-top: 4px; }
.product-card .price { color: var(--gold); font-weight: 700; margin-top: 6px; }

.typing { display: flex; gap: 4px; padding: 12px 16px; align-self: flex-start; }
.typing span {
  width: 8px; height: 8px; border-radius: 50%; background: var(--gray-600);
  animation: typingDot 1.4s infinite;
}
.typing span:nth-child(2) { animation-delay: 0.2s; }
.typing span:nth-child(3) { animation-delay: 0.4s; }
@keyframes typingDot { 0%,60%,100%{opacity:0.3;transform:translateY(0)}30%{opacity:1;transform:translateY(-4px)} }

/* Quick replies */
.quick-replies {
  display: flex; gap: 8px; flex-wrap: wrap; padding: 0 24px 8px;
}
.quick-btn {
  background: var(--dark-card); border: 1px solid var(--dark-border);
  color: var(--gray-400); padding: 8px 16px; border-radius: 100px;
  font-size: 0.82em; font-family: inherit; cursor: pointer;
  transition: all 0.2s;
}
.quick-btn:hover { border-color: var(--gold); color: var(--gold); }

/* Input */
.chat-input-area {
  padding: 16px 24px; border-top: 1px solid var(--dark-border);
  display: flex; gap: 12px;
}
.chat-input {
  flex: 1; background: var(--dark-card); border: 1px solid var(--dark-border);
  color: var(--white); padding: 12px 16px; border-radius: 12px;
  font-size: 0.92em; font-family: inherit; outline: none;
  transition: border 0.2s;
}
.chat-input:focus { border-color: var(--gold); }
.chat-input::placeholder { color: var(--gray-600); }
.send-btn {
  background: var(--gold); border: none; color: var(--dark);
  width: 44px; height: 44px; border-radius: 12px;
  font-size: 1.2em; cursor: pointer; display: flex;
  align-items: center; justify-content: center;
  transition: all 0.2s; font-weight: 700;
}
.send-btn:hover { background: #FFC857; }

/* Mobile */
@media (max-width: 768px) {
  .demo-sidebar { display: none; }
  .demo-layout { flex-direction: column; }
}
</style>
</head>
<body>

<div class="demo-header">
  <a href="../" class="back-link">‚Üê Volver a Solai</a>
  <h1>‚òÄÔ∏è <span>Solai</span> Demo</h1>
  <div class="demo-badge">Live Demo</div>
</div>

<div class="demo-layout">
  <!-- Sidebar -->
  <div class="demo-sidebar">
    <div class="sidebar-section">
      <h3>Cliente: Empire Essence</h3>
      <p>Perfumer√≠a artesanal con 26 fragancias inspiradas en marcas premium. El chatbot AI atiende clientes 24/7, recomienda perfumes y agenda pedidos.</p>
    </div>

    <div class="sidebar-section">
      <h3>M√©tricas en vivo</h3>
      <div class="stat-grid">
        <div class="stat-box"><div class="val" id="convCount">0</div><div class="lbl">Conversaciones</div></div>
        <div class="stat-box"><div class="val" id="msgCount">0</div><div class="lbl">Mensajes</div></div>
        <div class="stat-box"><div class="val" id="recCount">0</div><div class="lbl">Recomendaciones</div></div>
        <div class="stat-box"><div class="val" id="leadCount">0</div><div class="lbl">Leads capturados</div></div>
      </div>
    </div>

    <div class="sidebar-section">
      <h3>Capacidades del bot</h3>
      <ul class="feature-list">
        <li><span class="icon">‚úì</span> Recomienda perfumes por ocasi√≥n, g√©nero o nota</li>
        <li><span class="icon">‚úì</span> Describe notas olfativas en detalle</li>
        <li><span class="icon">‚úì</span> Sugiere alternativas si no hay stock</li>
        <li><span class="icon">‚úì</span> Captura datos del lead autom√°ticamente</li>
        <li><span class="icon">‚úì</span> Responde preguntas frecuentes</li>
        <li><span class="icon">‚úì</span> Escala a humano cuando es necesario</li>
        <li><span class="icon">‚úì</span> Tono de marca personalizado</li>
      </ul>
    </div>

    <div class="sidebar-section">
      <h3>Esto es lo que Solai instala</h3>
      <p>Este chatbot se conecta a WhatsApp, Instagram o tu web. T√∫ solo recibes notificaci√≥n cuando hay un lead caliente listo para cerrar.</p>
    </div>
  </div>

  <!-- Chat -->
  <div class="chat-area">
    <div class="chat-header">
      <div class="chat-avatar">üëë</div>
      <div>
        <div class="chat-name">Empire Essence</div>
        <div class="chat-status">‚óè En l√≠nea</div>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages"></div>
    <div class="quick-replies" id="quickReplies"></div>

    <div class="chat-input-area">
      <input type="text" class="chat-input" id="chatInput" placeholder="Escribe tu mensaje..." autocomplete="off">
      <button class="send-btn" id="sendBtn">‚Üí</button>
    </div>
  </div>
</div>

<script>
// ========== FRAGRANCE DATABASE ==========
const fragrances = [
  { id:1, name:"Aventus", inspired:"Creed Aventus", cat:"masculina", top:["pi√±a","grosella negra","manzana","bergamota"], heart:["abedul","pachul√≠","rosa","jazm√≠n"], base:["musgo de roble","almizcle","√°mbar gris","vainilla"], desc:"Frutal y audaz con un coraz√≥n ahumado de abedul. Ic√≥nico aroma de poder y sofisticaci√≥n.", price:"$85.000" },
  { id:2, name:"Sauvage", inspired:"Dior Sauvage", cat:"masculina", top:["bergamota","pimienta"], heart:["lavanda","vetiver","pachul√≠"], base:["ambroxan","cedro"], desc:"Fresco y salvaje con bergamota vibrante y fondo amaderado potente.", price:"$75.000" },
  { id:3, name:"One Million", inspired:"Paco Rabanne One Million", cat:"masculina", top:["mandarina","pomelo","menta"], heart:["canela","rosa"], base:["√°mbar","cuero","pachul√≠"], desc:"Dulce, especiado y magn√©tico. Irradia confianza.", price:"$70.000" },
  { id:4, name:"Invictus", inspired:"Paco Rabanne Invictus", cat:"masculina", top:["notas marinas","pomelo"], heart:["laurel","jazm√≠n"], base:["√°mbar gris","madera de guayaco"], desc:"Acu√°tico y fresco con toque atl√©tico.", price:"$70.000" },
  { id:5, name:"Bleu", inspired:"Bleu de Chanel", cat:"masculina", top:["lim√≥n","bergamota","menta"], heart:["lavanda","geranio"], base:["s√°ndalo","cedro","√°mbar"], desc:"Elegante y vers√°til. El perfume del hombre sofisticado.", price:"$80.000" },
  { id:6, name:"Le Male", inspired:"JPG Le Male", cat:"masculina", top:["lavanda","menta","cardamomo"], heart:["canela","flor de naranjo"], base:["vainilla","haba tonka","√°mbar"], desc:"Cl√°sico masculino. Seductor y reconfortante.", price:"$70.000" },
  { id:7, name:"212 VIP Men", inspired:"CH 212 VIP Men", cat:"masculina", top:["maracuy√°","lima","pimienta"], heart:["vodka","menta"], base:["√°mbar","cuero"], desc:"Vibrante y festivo. Perfume de fiesta.", price:"$70.000" },
  { id:8, name:"Bad Boy", inspired:"CH Bad Boy", cat:"masculina", top:["pimienta blanca","bergamota"], heart:["cedro","salvia"], base:["haba tonka","cacao"], desc:"Especiado y oscuro. Rebelde con estilo.", price:"$75.000" },
  { id:9, name:"Eros", inspired:"Versace Eros", cat:"masculina", top:["menta","manzana verde","lim√≥n"], heart:["haba tonka","ambroxan"], base:["vainilla","cedro","vetiver"], desc:"Fresco y dulce. Poderoso y seductor.", price:"$70.000" },
  { id:10, name:"Fahrenheit", inspired:"Dior Fahrenheit", cat:"masculina", top:["nuez moscada","lavanda","cedro"], heart:["violeta","nuez moscada"], base:["cuero","√°mbar","pachul√≠"], desc:"Ic√≥nico. Masculinidad cruda y sofisticada.", price:"$75.000" },
  { id:11, name:"Good Girl", inspired:"CH Good Girl", cat:"femenina", top:["almendra","caf√©","bergamota"], heart:["tuberosa","jazm√≠n","rosa"], base:["haba tonka","cacao","vainilla"], desc:"Dualidad irresistible. Femenina y poderosa.", price:"$80.000" },
  { id:12, name:"212 VIP Ros√©", inspired:"CH 212 VIP Ros√©", cat:"femenina", top:["champ√°n rosado","pimienta rosa"], heart:["durazno","rosa"], base:["almizcle blanco"], desc:"Burbujeante y femenina. Noche de celebraci√≥n.", price:"$70.000" },
  { id:13, name:"La Vie Est Belle", inspired:"Lanc√¥me La Vie Est Belle", cat:"femenina", top:["grosella negra","pera"], heart:["iris","jazm√≠n","flor de naranjo"], base:["pralin√©","vainilla","pachul√≠"], desc:"Dulce y radiante. Un abrazo de felicidad.", price:"$75.000" },
  { id:14, name:"J'adore", inspired:"Dior J'adore", cat:"femenina", top:["pera","mel√≥n","magnolia","durazno"], heart:["jazm√≠n","lirio","tuberosa","rosa"], base:["almizcle","vainilla","cedro"], desc:"Bouquet floral lujoso. La quintaesencia de la feminidad.", price:"$80.000" },
  { id:15, name:"CH", inspired:"Carolina Herrera CH", cat:"femenina", top:["frutas tropicales","bergamota"], heart:["pralin√©","canela","jazm√≠n","rosa"], base:["gamuza","pachul√≠","s√°ndalo"], desc:"Sofisticada y c√°lida. Elegancia con alma latina.", price:"$75.000" },
  { id:16, name:"Black Opium", inspired:"YSL Black Opium", cat:"femenina", top:["pera","pimienta rosa"], heart:["caf√©","jazm√≠n"], base:["vainilla","pachul√≠"], desc:"Adictiva y nocturna. Rock and roll en perfume.", price:"$80.000" },
  { id:17, name:"Chance", inspired:"Chanel Chance", cat:"femenina", top:["pimienta rosa","pi√±a","iris"], heart:["jazm√≠n","rosa"], base:["pachul√≠","almizcle","vainilla"], desc:"Fresca y vivaz. Feminidad moderna.", price:"$75.000" },
  { id:18, name:"Bright Crystal", inspired:"Versace Bright Crystal", cat:"femenina", top:["granada","yuzu"], heart:["peon√≠a","magnolia","loto"], base:["almizcle","√°mbar"], desc:"Cristalina y luminosa. Sensual y et√©rea.", price:"$70.000" },
  { id:19, name:"Amor Amor", inspired:"Cacharel Amor Amor", cat:"femenina", top:["grosella negra","naranja","mandarina"], heart:["rosa","jazm√≠n"], base:["vainilla","haba tonka","almizcle"], desc:"Frutal y apasionada. Explosi√≥n de frutas rojas.", price:"$65.000" },
  { id:20, name:"Flowerbomb", inspired:"V&R Flowerbomb", cat:"femenina", top:["t√©","bergamota"], heart:["orqu√≠dea","jazm√≠n","rosa"], base:["pachul√≠","vainilla"], desc:"Explosi√≥n floral adictiva. Bouquet sensual.", price:"$80.000" },
  { id:21, name:"Baccarat Rouge", inspired:"MFK Baccarat Rouge 540", cat:"unisex", top:["azafr√°n","jazm√≠n"], heart:["√°mbar","hediona"], base:["resina de abeto","cedro","ambroxan"], desc:"Luminoso y et√©reo. Una fragancia que hipnotiza.", price:"$95.000" },
  { id:22, name:"Oud Wood", inspired:"Tom Ford Oud Wood", cat:"unisex", top:["palo de rosa","cardamomo"], heart:["oud","s√°ndalo","vetiver"], base:["haba tonka","vainilla"], desc:"Sofisticado y misterioso. Lujo silencioso.", price:"$90.000" },
  { id:23, name:"Erba Pura", inspired:"Xerjoff Erba Pura", cat:"unisex", top:["naranja","bergamota","lim√≥n"], heart:["frutas"], base:["almizcle blanco","vainilla","√°mbar"], desc:"C√≠tricos vibrantes y frutas jugosas. Pura alegr√≠a.", price:"$85.000" },
  { id:24, name:"Tobacco Vanille", inspired:"Tom Ford Tobacco Vanille", cat:"unisex", top:["tabaco","especias"], heart:["vainilla","cacao","haba tonka"], base:["frutas secas","maderas"], desc:"C√°lido y opulento. Como un sal√≥n de lujo.", price:"$90.000" },
  { id:25, name:"Kirke", inspired:"Tiziana Terenzi Kirke", cat:"unisex", top:["maracuy√°","durazno","pera","frambuesa"], heart:["lirio de los valles"], base:["almizcle","s√°ndalo","vainilla"], desc:"Frutal y luminoso. Elegancia natural.", price:"$85.000" },
  { id:26, name:"Arabian Tonka", inspired:"Montale Arabians Tonka", cat:"unisex", top:["azafr√°n","bergamota"], heart:["oud","rosa b√∫lgara"], base:["haba tonka","√°mbar","almizcle"], desc:"Oriental y envolvente. Noches √°rabes en cada gota.", price:"$85.000" }
];

// ========== CHATBOT ENGINE ==========
const msgs = document.getElementById('chatMessages');
const input = document.getElementById('chatInput');
const qr = document.getElementById('quickReplies');
let stats = { conv: 1, msg: 0, rec: 0, lead: 0 };
let context = { step: 'greeting', gender: null, occasion: null, leadCaptured: false };

function updateStats() {
  document.getElementById('convCount').textContent = stats.conv;
  document.getElementById('msgCount').textContent = stats.msg;
  document.getElementById('recCount').textContent = stats.rec;
  document.getElementById('leadCount').textContent = stats.lead;
}

function addMsg(text, isUser, products) {
  const div = document.createElement('div');
  div.className = `msg ${isUser ? 'msg-user' : 'msg-bot'}`;
  let html = text.replace(/\n/g, '<br>');
  if (products && products.length > 0) {
    products.forEach(p => {
      html += `<div class="product-card">
        <h4>üëë ${p.name}</h4>
        <div class="notes">üå∏ ${p.top.slice(0,3).join(', ')} ‚Üí ${p.heart.slice(0,2).join(', ')} ‚Üí ${p.base.slice(0,2).join(', ')}</div>
        <div class="inspired">Inspirado en ${p.inspired}</div>
        <div style="margin-top:6px;font-size:0.85em;color:var(--gray-400)">${p.desc}</div>
        <div class="price">${p.price} COP</div>
      </div>`;
      stats.rec++;
    });
  }
  div.innerHTML = html;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
  stats.msg++;
  updateStats();
}

function showTyping() {
  const div = document.createElement('div');
  div.className = 'typing';
  div.id = 'typingIndicator';
  div.innerHTML = '<span></span><span></span><span></span>';
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function hideTyping() {
  const t = document.getElementById('typingIndicator');
  if (t) t.remove();
}

function setQuickReplies(options) {
  qr.innerHTML = '';
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.className = 'quick-btn';
    btn.textContent = opt;
    btn.onclick = () => handleUserMessage(opt);
    qr.appendChild(btn);
  });
}

function botReply(text, products, quickReplies, delay) {
  showTyping();
  setTimeout(() => {
    hideTyping();
    addMsg(text, false, products);
    if (quickReplies) setQuickReplies(quickReplies);
  }, delay || 800 + Math.random() * 800);
}

function findByGender(g) { return fragrances.filter(f => f.cat === g); }
function findByNote(note) {
  const n = note.toLowerCase();
  return fragrances.filter(f =>
    [...f.top,...f.heart,...f.base].some(x => x.toLowerCase().includes(n))
  );
}
function findByOccasion(occ) {
  const map = {
    'cita': ['Aventus','Sauvage','Good Girl','Black Opium','Baccarat Rouge','Eros'],
    'trabajo': ['Bleu','Sauvage','CH','La Vie Est Belle','J\'adore','Erba Pura'],
    'fiesta': ['One Million','212 VIP Men','212 VIP Ros√©','Bad Boy','Invictus','Eros'],
    'diario': ['Invictus','Chance','Bright Crystal','Erba Pura','Le Male','Amor Amor'],
    'regalo': ['Baccarat Rouge','Good Girl','Tobacco Vanille','Flowerbomb','J\'adore','Oud Wood'],
    'especial': ['Baccarat Rouge','Oud Wood','Tobacco Vanille','Kirke','Arabian Tonka']
  };
  const names = map[occ] || map['diario'];
  return fragrances.filter(f => names.includes(f.name));
}

function handleUserMessage(text) {
  addMsg(text, true);
  qr.innerHTML = '';
  const lower = text.toLowerCase();

  // Gender detection
  if (lower.includes('hombre') || lower.includes('masculin') || lower.includes('√©l') || lower.includes('novio') || lower.includes('esposo')) {
    context.gender = 'masculina';
  } else if (lower.includes('mujer') || lower.includes('femenin') || lower.includes('ella') || lower.includes('novia') || lower.includes('esposa')) {
    context.gender = 'femenina';
  } else if (lower.includes('unisex') || lower.includes('ambos') || lower.includes('cualquier')) {
    context.gender = 'unisex';
  }

  // Occasion detection
  if (lower.includes('cita') || lower.includes('rom√°ntic') || lower.includes('seduci')) context.occasion = 'cita';
  else if (lower.includes('trabajo') || lower.includes('oficina') || lower.includes('formal')) context.occasion = 'trabajo';
  else if (lower.includes('fiesta') || lower.includes('salir') || lower.includes('noche') || lower.includes('rumba')) context.occasion = 'fiesta';
  else if (lower.includes('diario') || lower.includes('casual') || lower.includes('d√≠a a d√≠a')) context.occasion = 'diario';
  else if (lower.includes('regalo')) context.occasion = 'regalo';
  else if (lower.includes('especial') || lower.includes('exclusiv') || lower.includes('nicho')) context.occasion = 'especial';

  // Note search
  const noteKeywords = ['vainilla','√°mbar','rosa','jazm√≠n','caf√©','lavanda','menta','c√≠tric','frutal','madera','cuero','oud','pachul√≠','canela','tabaco','azafr√°n','cacao'];
  const foundNote = noteKeywords.find(n => lower.includes(n));

  // Price questions
  if (lower.includes('precio') || lower.includes('cu√°nto') || lower.includes('cuanto') || lower.includes('cuesta') || lower.includes('valor')) {
    const specific = fragrances.find(f => lower.includes(f.name.toLowerCase()));
    if (specific) {
      botReply(`${specific.name} tiene un valor de **${specific.price} COP** por 100ml. üß¥\n\nNuestra f√≥rmula tiene 60% de esencia concentrada ‚Äî dura todo el d√≠a.\n\n¬øTe gustar√≠a pedirlo?`, null,
        ['S√≠, quiero pedirlo', 'Ver m√°s opciones', 'Tengo otra pregunta']);
    } else {
      botReply(`Nuestros precios van desde $65.000 hasta $95.000 COP por 100ml. üß¥\n\nTodas las fragancias tienen 60% de concentraci√≥n de esencia ‚Äî mucho m√°s que las marcas comerciales.\n\n¬øSobre cu√°l fragancia te gustar√≠a saber el precio exacto?`, null,
        ['Ver masculinas', 'Ver femeninas', 'Ver unisex']);
    }
    return;
  }

  // Ordering intent
  if (lower.includes('pedir') || lower.includes('comprar') || lower.includes('quiero') || lower.includes('ordenar') || lower.includes('env√≠o') || lower.includes('envio')) {
    if (!context.leadCaptured) {
      context.leadCaptured = true;
      stats.lead++;
      updateStats();
    }
    botReply(`¬°Excelente elecci√≥n! üéâ\n\nPara procesar tu pedido necesito:\n\nüì± Tu WhatsApp\nüìç Ciudad de env√≠o\nüß¥ Fragancia(s) que quieres\n\nO si prefieres, te puedo conectar directo con uno de nuestros asesores para que te atienda personalmente. ¬øQu√© prefieres?`, null,
      ['Hablar con un asesor', 'Seguir explorando']);
    return;
  }

  // Asesor
  if (lower.includes('asesor') || lower.includes('humano') || lower.includes('persona') || lower.includes('hablar con')) {
    if (!context.leadCaptured) { context.leadCaptured = true; stats.lead++; updateStats(); }
    botReply(`¬°Perfecto! üôå\n\nTe conecto con David, nuestro asesor experto en fragancias. Te escribir√° por WhatsApp en los pr√≥ximos minutos.\n\nüì± WhatsApp: +57 XXX XXX XXXX\n\n¬°Gracias por elegirnos! üëë`, null, ['Mientras, recomi√©ndame algo']);
    return;
  }

  // Specific fragrance name mentioned
  const specificFragrance = fragrances.find(f => lower.includes(f.name.toLowerCase()) || lower.includes(f.inspired.toLowerCase().split(' ').pop()));
  if (specificFragrance) {
    const allNotes = [...specificFragrance.top, ...specificFragrance.heart, ...specificFragrance.base];
    botReply(`¬°Gran elecci√≥n! Te cuento sobre **${specificFragrance.name}**: üß¥\n\n${specificFragrance.desc}\n\nüîù Salida: ${specificFragrance.top.join(', ')}\nüíó Coraz√≥n: ${specificFragrance.heart.join(', ')}\nüåø Base: ${specificFragrance.base.join(', ')}`, [specificFragrance],
      ['Quiero pedirlo', 'Algo similar', 'Ver m√°s opciones']);
    return;
  }

  // Note-based search
  if (foundNote) {
    const results = findByNote(foundNote).slice(0, 3);
    if (results.length > 0) {
      botReply(`¬°Tienes buen gusto! Aqu√≠ tienes fragancias con notas de **${foundNote}**: üå∏`, results,
        ['Quiero pedirlo', 'Ver m√°s opciones', 'Buscar otra nota']);
      return;
    }
  }

  // Gender-based browsing
  if (lower.includes('masculin') || lower === 'ver masculinas' || lower === 'para hombre') {
    const results = findByGender('masculina').slice(0, 3);
    botReply(`Aqu√≠ tienes nuestros top masculinos: üí™`, results,
      ['Para una cita', 'Para el trabajo', 'Para fiesta', 'Ver m√°s masculinas']);
    return;
  }
  if (lower.includes('femenin') || lower === 'ver femeninas' || lower === 'para mujer') {
    const results = findByGender('femenina').slice(0, 3);
    botReply(`Nuestras fragancias femeninas m√°s populares: üíÉ`, results,
      ['Para una cita', 'Para el trabajo', 'Para regalo', 'Ver m√°s femeninas']);
    return;
  }
  if (lower.includes('unisex')) {
    const results = findByGender('unisex').slice(0, 3);
    botReply(`Nuestra colecci√≥n unisex ‚Äî fragancias sin g√©nero que enamoran: ‚ú®`, results,
      ['Cu√©ntame m√°s de Baccarat', 'Ver precios', 'Quiero pedirlo']);
    return;
  }

  // Occasion-based
  if (context.occasion) {
    const results = findByOccasion(context.occasion).slice(0, 3);
    const occLabel = { cita:'una cita rom√°ntica üíï', trabajo:'el trabajo üíº', fiesta:'fiesta üéâ', diario:'uso diario ‚òÄÔ∏è', regalo:'regalo üéÅ', especial:'una ocasi√≥n especial ‚ú®' };
    botReply(`Para ${occLabel[context.occasion] || context.occasion}, te recomiendo:`, results,
      ['Quiero pedirlo', 'Ver m√°s opciones', 'Buscar por nota']);
    context.occasion = null;
    return;
  }

  // Gender chosen but no occasion
  if (context.gender && !context.occasion) {
    botReply(`¬°Perfecto! ¬øPara qu√© ocasi√≥n buscas la fragancia? ü§î`, null,
      ['Para una cita', 'Para el trabajo', 'Para fiesta', 'Uso diario', 'Es un regalo']);
    return;
  }

  // Greeting or generic
  if (lower.includes('hola') || lower.includes('buenas') || lower.includes('hey') || lower.includes('hi') || context.step === 'greeting') {
    context.step = 'exploring';
    botReply(`¬°Hola! üëã Bienvenido/a a **Empire Essence** üëë\n\nSoy tu asesor virtual de fragancias. Puedo ayudarte a encontrar el perfume perfecto.\n\n¬øPara qui√©n buscas hoy?`, null,
      ['Para hombre', 'Para mujer', 'Unisex', 'Es un regalo']);
    return;
  }

  // FAQ
  if (lower.includes('concentr') || lower.includes('dura') || lower.includes('duraci√≥n') || lower.includes('f√≥rmula') || lower.includes('formula')) {
    botReply(`¬°Buena pregunta! üß™\n\nNuestras fragancias tienen **60% de esencia concentrada** ‚Äî eso es m√°s que la mayor√≠a de perfumes de marca (que suelen tener 15-20%).\n\nAdem√°s incluimos fijador profesional y feromonas. Duraci√≥n promedio: **8-12 horas**.\n\n¬øTe gustar√≠a ver nuestro cat√°logo?`, null,
      ['Ver masculinas', 'Ver femeninas', 'Ver unisex']);
    return;
  }

  if (lower.includes('env√≠o') || lower.includes('envio') || lower.includes('domicilio') || lower.includes('entrega')) {
    botReply(`üì¶ Hacemos env√≠os a toda Colombia.\n\nüèôÔ∏è Bogot√°: entrega en 1-2 d√≠as\nüá®üá¥ Otras ciudades: 3-5 d√≠as h√°biles\n\n¬øTe gustar√≠a hacer un pedido?`, null,
      ['S√≠, quiero pedir', 'Ver cat√°logo primero']);
    return;
  }

  // Fallback
  botReply(`¬°Interesante! ü§î Te puedo ayudar mejor si me cuentas:\n\n‚Ä¢ ¬øPara qui√©n es? (hombre, mujer, unisex)\n‚Ä¢ ¬øPara qu√© ocasi√≥n? (cita, trabajo, fiesta, diario)\n‚Ä¢ ¬øHay alguna nota que te guste? (vainilla, madera, flores, c√≠tricos)\n\nO si prefieres, explora nuestro cat√°logo:`, null,
    ['Para hombre', 'Para mujer', 'Unisex', 'Ver todo', 'Hablar con asesor']);
}

// ========== EVENT LISTENERS ==========
document.getElementById('sendBtn').onclick = () => {
  const text = input.value.trim();
  if (text) { handleUserMessage(text); input.value = ''; }
};
input.addEventListener('keydown', e => {
  if (e.key === 'Enter') { document.getElementById('sendBtn').click(); }
});

// ========== INIT ==========
updateStats();
setTimeout(() => {
  botReply(`¬°Hola! üëã Bienvenido/a a **Empire Essence** üëë\n\nSoy tu asesor virtual de fragancias artesanales. Tenemos 26 perfumes inspirados en las mejores marcas del mundo, con **60% de esencia concentrada**.\n\n¬øEn qu√© puedo ayudarte hoy?`, null,
    ['Para hombre', 'Para mujer', 'Unisex', 'Es un regalo', 'Ver precios']);
  context.step = 'exploring';
}, 1000);
</script>
</body>
</html>
